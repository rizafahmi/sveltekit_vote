<script>
 import { onMount } from 'svelte';

 const baseUrl = "https://vote-live.herokuapp.com";
 // const baseUrl = `http://192.168.1.105:3000`
 let topics = [];
 let voteStatus = true;

 onMount(function() {
     const lastVisit = localStorage.getItem('lastVisit')
     console.log(lastVisit)
     if(lastVisit !== null && new Date().getTime() - lastVisit < 50000000) {
         voteStatus = false;
     }
 });

 async function getTopics() {
     const res = await fetch(`${baseUrl}/topics`);
     const data = await res.json();
     topics = data.topics;
 }

 getTopics();

 async function handleVote(id) {

     const res = await fetch(`${baseUrl}/topics`, {
         method: 'PATCH',
         body: JSON.stringify({id: id})
     });
     const data = await res.json();
     topics = data.topics;
     localStorage.setItem('lastVisit', new Date().getTime())
     voteStatus = false;
 }
</script>

<div class="container">
    <header>
        <h1 class="text-4xl text-red-500">Vote Topik Livestreaming</h1>
        {#if voteStatus === false}
            <p>Terimaksih sudah kontribusi vote. Vote lagi lain waktu.
            </p>
        {/if}
    </header>

    <ul>
        {#each topics as topic}
            <li><div>{topic.title}
                {#if voteStatus === true}
                    <button class="btn" on:click={() => handleVote(topic.id)}>Vote({topic.vote})</button>
                {:else}
                    <button class="btn" disabled>Vote({topic.vote})</button>
                {/if}
            </div></li>
        {/each}
    </ul>
</div>

<style>
 .container {
     @apply py-4 px-6 flex flex-col items-center;
 }
 h1 {
     @apply pb-6;
 }
</style>
